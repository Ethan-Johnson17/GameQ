var T=Object.defineProperty,X=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var j=(d,o,l)=>o in d?T(d,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):d[o]=l,D=(d,o)=>{for(var l in o||(o={}))E.call(o,l)&&j(d,l,o[l]);if(Q)for(var l of Q(o))F.call(o,l)&&j(d,l,o[l]);return d},A=(d,o)=>X(d,L(o));import{_ as K,P as z,A as r,g as k,l as u,a as y,p as C,b as P,c as G,d as J,s as M}from"./index.e3d4859c.js";import{g as V,l as U,u as W,w as H,c as v,a as S,o as n,b as c,d as t,t as m,m as h,h as B,F as b,k as w,i as Y,v as Z,p as q,j as $,G as ee,e as I,B as R,n as O}from"./vendor.b0e93d7b.js";const te={components:{PlayerItems:z},setup(){const d=V(""),o=U(),l=W(),a=V("Choose a game!");return H(async()=>{try{if(o.params.id&&(await G.findGameNightId(o.params.id),await k.getAllGameQueue(o.params.id),await J.getMyGames("/account/myGames"),await G.getAllPlayers(o.params.id),M.joinRoom(o.params.id)),r.activeGameNight.accountId===r.account.id){await G.getMyGameNights("/account/gamenight");const i=r.myGameNights.find(g=>g.id===o.params.id);r.activeGameNight=i,M.joinRoom(o.params.id)}}catch(e){u.error(e),y.toast("error","error")}}),{editable:d,route:o,newGame:a,player:v(()=>r.players.find(e=>e.accountId===r.account.id)),players:v(()=>r.players),activeGameNight:v(()=>r.activeGameNight),closetGames:v(()=>r.myGames.filter(e=>e.owned)),account:v(()=>r.account),gameQueue:v(()=>r.gameQueue),sortedGameQueue:v(()=>[...r.gameQueue].sort((e,i)=>i.votes.length-e.votes.length)),arrOfNames:v(()=>r.gameQueue.map(e=>e.game.name)),formatDate(e){return new Date(e).toLocaleString()},async addGame(e){try{const i=a.value,g=r.myGames.find(N=>N.name===i);if(a.value==="Choose a game!")return;let x={gameId:g.id,gameNightId:r.activeGameNight.id};await k.addToGameQueue(x),a.value="Choose a game!"}catch(i){u.error(i),y.toast("Someone is bringing that game.","warning")}},async removeGameQueue(e){try{if(!await y.confirm("Delete your game?"))return;await k.removeGameQueue(e)}catch(i){u.error(i),y.toast(i.message,"error")}},async joinGameNight(e){try{await C.attendGameNight(e),this.addXp()}catch(i){u.error(i),y.toast("Something went wrong joining the game!","error")}},async addXp(){let e=r.account;e.xp+=5,e.xp>=640?e.rank="Noob-Slayer":e.xp>=320?e.rank="Royalty":e.xp>=160?e.rank="Champion":e.xp>=80?e.rank="Knight":e.xp>=40&&(e.rank="Squire"),u.log("xp",e),await P.edit(e)},async minusXp(){let e=r.account;e.xp-=5,e.xp>=640?e.rank="Noob-Slayer":e.xp>=320?e.rank="Royalty":e.xp>=160?e.rank="Champion":e.xp>=80?e.rank="Knight":e.xp>=40&&(e.rank="Squire"),u.log("xp",e),await P.edit(e)},async vote(e){try{await k.vote(e)}catch(i){u.error(i)}},async editMyItems(){try{const e=r.players.find(g=>g.account.id===r.account.id);let i=A(D({},e),{items:d.value});await C.editMyItems(i),d.value=""}catch(e){u.error(e),y.toast(e)}},async unattendGameNight(e){try{await y.confirm("Are you sure you want to leave this game night??")&&(await C.unattendGameNight(e),await G.getAllPlayers(o.params.id),l.push({name:"GameNight"})),this.minusXp()}catch(i){u.error(i),y.toast(i)}}}}},_=d=>(q("data-v-c2e6408c"),d=d(),$(),d),ae={class:"container-fluid"},se={class:"row justify-content-center p-2"},oe={class:"col-md-10 card my-2 elevation-3 px-5 py-3"},ie={class:"row justify-content-center"},ne={class:"col-3"},ce={class:"m-3"},re={class:"col-md-6 text-dark text-center p-3"},de={class:"col-md-3 text-end p-1"},le={class:"row"},me={class:"col text-dark text-center"},ue={key:0,class:"text-dark bg-warning"},he={class:"row"},_e={class:"col"},ye={key:0,class:"row mb-2"},ve={class:"col-md-4"},ge={class:"dropdown input-group"},pe={class:"btn btn-secondary dropdown-toggle form-control",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false",style:{"background-color":"#814cb6"}},fe={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},be=["onClick"],we=_(()=>t("button",{class:"btn bg-white border border-secondary text-secondary px-2",type:"submit"},[t("i",{class:"mdi mdi-plus-thick"})],-1)),ke={class:"row"},Ge={class:"col-md-6"},xe=_(()=>t("h3",null,"Vote on the Game(s) to play!",-1)),Ne={class:"col"},Ce={class:"vote d-flex"},Se={key:0},Ie=["onClick"],Qe=["onClick"],je=["data-bs-target"],De=["onClick"],Ae={class:"col-md-6"},Pe={class:"row justify-content-end"},Me={class:"col-md-10 bg-primary mb-3 pb-2 mx-2"},Ve=_(()=>t("div",{class:"row"},[t("div",{class:"col text-center mt-3"},[t("h3",null,[t("b",null,"Total Votes")]),t("hr")])],-1)),Be={key:0,class:"col-9 my-2 mdi"},Re=_(()=>t("i",{class:"mdi mdi-chess-king ms-1"},null,-1)),Oe=_(()=>t("hr",null,null,-1)),Te={key:1,class:"col-9 my-2 mdi"},Xe={class:"col-3 my-2"},Le=_(()=>t("hr",null,null,-1)),Ee={class:"row"},Fe={class:"col-6"},Ke=_(()=>t("h3",{class:"mb-5"},"What everyone's bringing...",-1)),ze={key:0,class:"input-group"},Je=_(()=>t("button",{class:"btn btn-secondary",type:"submit"},[t("i",{class:"mdi mdi-plus-thick"})],-1)),Ue={class:"col my-2"},We={class:"col-6 text-center"},He=_(()=>t("h3",{class:"mb-5"},"Attending",-1)),Ye={class:"col d-flex"},Ze=["src"],qe={class:"mt-3"},$e={class:"fnt ms-3 py-1 mt-2 text-grey"};function et(d,o,l,a,e,i){const g=S("GameDetails"),x=S("OffCanvas"),N=S("PlayerItems");return n(),c("div",ae,[t("div",se,[t("div",oe,[t("div",ie,[t("div",ne,[t("h5",ce,"PIN: "+m(a.activeGameNight.pin),1)]),t("div",re,[t("h3",null,m(a.activeGameNight.name),1)]),t("div",de,[a.player?h("",!0):(n(),c("button",{key:0,class:"btn btn-secondary px-4",onClick:o[0]||(o[0]=s=>a.joinGameNight(a.activeGameNight.pin))}," Join ")),a.player?(n(),c("button",{key:1,class:"btn btn-danger px-4",onClick:o[1]||(o[1]=s=>a.unattendGameNight(a.player.id))}," Leave ")):h("",!0)])]),t("div",le,[t("div",me,[t("h3",null,m(a.formatDate(a.activeGameNight.gameNightDate)),1),t("h3",null,m(a.activeGameNight.location),1),a.activeGameNight.isCancelled?(n(),c("h3",ue," Cancelled ")):h("",!0)])]),t("div",he,[t("div",_e,[a.player?(n(),c("div",ye,[t("div",ve,[t("form",{onSubmit:o[2]||(o[2]=B((...s)=>a.addGame&&a.addGame(...s),["prevent"]))},[t("div",ge,[t("button",pe,m(a.newGame),1),t("ul",fe,[(n(!0),c(b,null,w(a.closetGames,s=>(n(),c("li",{key:s.atlasGameId},[t("div",{class:ee(["dropdown-item selectable",a.arrOfNames.includes(s.name)?"disabled":""]),onClick:p=>a.newGame=s.name},m(s.name),11,be)]))),128))]),we])],32)])])):h("",!0)])]),t("div",ke,[t("div",Ge,[xe,(n(!0),c(b,null,w(a.gameQueue,s=>{var p;return n(),c("div",{class:"row",key:s.id},[t("div",Ne,[t("div",Ce,[a.player?(n(),c("div",Se,[s.votes.includes(a.account.id)?h("",!0):(n(),c("i",{key:0,class:"mdi mdi-thumb-up-outline text-secondary f-16 pt-0 selectable h-25 me-2",onClick:f=>a.vote(s.id)},null,8,Ie)),s.votes.includes(a.account.id)?(n(),c("i",{key:1,class:"mdi mdi-thumb-up text-secondary f-16 pt-0 selectable h-25 me-2",onClick:f=>a.vote(s.id)},null,8,Qe)):h("",!0)])):h("",!0),t("p",{class:"mb-0 selectable","data-bs-toggle":"offcanvas","data-bs-target":"#gameDetails-"+s.game.id},m((p=s.game)==null?void 0:p.name),9,je),a.account.id===s.accountId?(n(),c("i",{key:1,class:"mdi mdi-trash-can f-20 text-danger ms-auto selectable",onClick:f=>a.removeGameQueue(s.id)},null,8,De)):h("",!0)])]),I(x,{id:"gameDetails-"+s.game.id},{"offcanvas-title":R(()=>[O(m(s.game.name)+" Details",1)]),"offcanvas-body":R(()=>[I(g,{game:s.game},null,8,["game"])]),_:2},1032,["id"])])}),128))]),t("div",Ae,[t("div",Pe,[t("div",Me,[Ve,(n(!0),c(b,null,w(a.sortedGameQueue,s=>{var p,f;return n(),c("div",{class:"row",key:s.id},[s==a.sortedGameQueue[0]?(n(),c("div",Be,[O(m((p=s.game)==null?void 0:p.name)+" ",1),Re,Oe])):(n(),c("div",Te,m((f=s.game)==null?void 0:f.name),1)),t("div",Xe,m(s.votes.length),1)])}),128))])])]),Le]),t("div",Ee,[t("div",Fe,[Ke,t("form",{onSubmit:o[4]||(o[4]=B(s=>a.editMyItems(),["prevent"]))},[a.player?(n(),c("div",ze,[Y(t("input",{required:"",type:"text",class:"form-control",id:"items",placeholder:"Add items here...","onUpdate:modelValue":o[3]||(o[3]=s=>a.editable=s),maxlength:"1000"},null,512),[[Z,a.editable]]),Je])):h("",!0)],32),(n(!0),c(b,null,w(a.players,s=>(n(),c("div",{class:"row",key:s.id},[t("div",Ue,[I(N,{player:s},null,8,["player"])])]))),128))]),t("div",We,[He,(n(!0),c(b,null,w(a.players,s=>(n(),c("div",{class:"row",key:s.id},[t("div",Ye,[t("img",{class:"pic me-3 my-1",src:s.account.picture,alt:""},null,8,Ze),t("h5",qe,m(s.account.name),1),t("p",$e,m(s.account.rank),1)])]))),128))])])])])])}var ot=K(te,[["render",et],["__scopeId","data-v-c2e6408c"]]);export{ot as default};
